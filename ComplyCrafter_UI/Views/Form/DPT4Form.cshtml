<style>
    .textheader a {
        color: blue;
        text-decoration: none !important;
    }

    .textheader:hover a {
        color: red !important;
        cursor: pointer;
    }
</style>

<div class="row m-auto" id="frm">
    <div class="card " style="flex-direction:row;">
        <div class=" col-lg-12">
            <div class="card-header ">
                <h3>
                    Form No.DPT-4
                </h3>

            </div>
            <div class="card-body" style="padding:0px 25px;">
                <p>
                    Statement regarding deposits existing on the commencement of the Act

                    [Pursuant to Rule 20 of the Companies (Acceptance of Deposits) Rules, 2014]
                </p>

            </div>
            <div class="textheader my-4 mx-3">
                <a href="https://www.mca.gov.in/content/dam/mca-aem-forms/instructionkits/Instruction%20Kit_DPT-4.pdf" target="_blank">

                    Refer instruction kit for filing the forms

                </a>
            </div>
        </div>

    </div>

    <div class="content-wrapper">
        <div class="container-fluid">
            <main role="main" class="pb-3">
                <div class="row">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between" style="padding: 15px 30px 10px;">
                            <ul class="nav nav-pills nav-fill p-1 bg-transparent" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link mb-0 px-4 py-1 active " href="javascript:;" role="part1" data-bs-toggle="tab">
                                        <span class="ms-1">
                                            Entity's Details
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link mb-0 px-4 py-1 " href="javascript:;" role="part2" data-bs-toggle="tab">
                                        <span class="ms-1">
                                            Declaration & DSC Company
                                        </span>
                                    </a>
                                </li>

                            </ul>
                        </div>

                    </div>
                </div>


            </main>
        </div>
    </div>
    <div id="part2" class="p-0">
        <div class="card">




            <div class="col-xs-12 col-sm-12 col-md-12 form-row my-3" style="padding: 10px; height: auto;">
                <p style="text-align: justify; display: inline;">
                    I am authorized by the Board of Directors of the Company vide resolution no.&nbsp;
                    <input type="text"
                           name="resolutionNumber"
                           id="resolutionNumber"
                           style="width: 10%; box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);"
                           value=""
                           required="required" />&nbsp; Dated&nbsp;
                </p>

                <input type="date"
                       name="declarationDate"
                       id="declarationDate"
                       class="form-control"
                       style="width: 10%; display: inline-block; box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);"
                       value=""
                       required="required" />

                <div class="invalid-feedback" style="margin-left: 10px; display:inline;"></div>

                <p style="text-align: justify; display: inline;">
                    &nbsp;to sign this form and declare that all the requirements of the Companies Act, 2013 and the rules made thereunder in respect of the subject matter of this form and matters incidental thereto have been complied with. I also declare that all the information given herein above is true, correct and complete including the attachments to this form and nothing material has been suppressed.
                </p>
            </div>

            <div class="col-md-12  mx-3">
              
                <p class="textheader2 my-2">I also declare that all the information given herein above is true, correct and complete including the attachments to this form and nothing material has been suppressed.</p>
            </div>
            <div class="col-md-11 my-2 mx-2">
                <label class="form-label">
                    Designation
                </label>
                <select class="form-select" aria-label="Default select example" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" name="designation" id="designation">
                    <option selected="">Select Charge Id</option>
                    <option value="Director">Director</option>
                    <option value="Manager">Manager</option>
                    <option value="Company Secretary">Company Secretary</option>
                    <option value="CFO">CFO</option>
                    <option value="CEO">CEO</option>
                </select>
            </div>
            <div class="col-lg-11 my-2 mx-2">
                <label class="form-label">DIN of the director; PAN of the manager or CEO or CFO or IRP/RP/Liquidator or Authorised representative ; or membership number of company secretary</label>
                <input type="text" placeholder="" class="form-control nums" value="" name="managerPan" id="managerPan" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" disabled>
                <select name="managerPan" id="drpDirector" class="form-select" required="" style="display:none">
                    <option value="">Select Director</option>

                </select>
                <select name="managerPan" id="drpManager" class="form-select" required="" style="display:none">
                    <option value="">Select Manager</option>

                </select>
                <select name="managerPan" id="drpCeo" class="form-select" required="" style="display:none">
                    <option value="">Select CEO</option>

                </select>
                <select name="managerPan" id="drpCompanySecretary" class="form-select" required="" style="display:none">
                    <option value="">Select Company Secretary</option>
                </select>

                <select name="managerPan" id="drpCfo" class="form-select" required="" style="display:none">
                    <option value="">Select CFO</option>

                </select>
                <div class="invalid-feedback"></div>
            </div>
            <div class="col-lg-6 my-3 mx-2">
                <h6 class="typecharge" style=" border-bottom:1px solid black; display:inline-block;">
                    Attachments
                </h6>
            </div>
            <form id="frmCompany">
                <input type="hidden" class="nums" value="0" name="id" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" />

                <div class="row mt-2" style="">


                    <div class="row mt-3">
                        <div class="col-xs-12 col-sm-12 col-md-1 bold form-row" align="center">
                            Sr. No
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-10 bold form-row">
                            (a) Auditor’s certificate
                        </div>                     
                    </div>
                    <div id="">
                        <input type="hidden" name="l" id="l" value="1">
                        <div class="row " id="">
                            <div class="col-xs-12 col-sm-12 col-md-1 form-row" align="center">
                                1.
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-11 form-row">
                                <input type="file" name="attachment_file[]" id="attachmentfile_1" class="1">
                            </div>
                        </div>
                    
                    </div>

                </div>
                <div class="row mt-1" style="">

                    <div class="row mt-3">
                        <div class="col-xs-12 col-sm-12 col-md-1 bold form-row" align="center">
                            Sr. No
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-10 bold form-row">
                            (b) List of depositors                        </div>
                      
                    </div>
                                
                        <div id="">
                            <input type="hidden" name="l" id="l" value="1">

                            <div class="row " id="">
                                <div class="col-xs-12 col-sm-12 col-md-1 form-row" align="center">
                                    1.
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-11 form-row">
                                    <input type="file" name="attachment_file[]" id="attachmentfile_1" class="1">
                                </div>
                            </div>

                        </div>                
                </div>

                <div class="row my-2" style="">


                    <div class="row mt-3">
                        <div class="col-xs-12 col-sm-12 col-md-1 bold form-row" align="center">
                            Sr. No
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-10 bold form-row">
                            (c) Optional attachment(s)- if any
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-1 form-row" align="center">
                            <button type="button" name="attachmentadd" id="attachmentadd" class="btn-sm btn-primary"><i class=" fa-plus"></i></button>
                        </div>

                    </div>
                    <div id="equity" class="my-2 mb-3">
                        <input type="hidden" name="l" id="l" value="1">

                        <div class="row " id="">
                            <div class="col-xs-12 col-sm-12 col-md-1 form-row" align="center">
                                1.
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-11 form-row">
                                <input type="file" name="attachment_file[]" id="attachmentfile_1" class="1">
                            </div>
                        </div>

                    </div>

                </div>
                <template id="rowTemp">
                    <div class="row mt-3" id="rowq2">
                        <div class="col-xs-12 col-sm-12 col-md-1 form-row" align="center">
                            2.
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-10 form-row">
                            <input type="file" name="optionalAttachment" id="attachmentfile_12" class="2">
                        </div>
                        <div class="col-xl-1 col-lg-1 col-md-12 col-sm-12 col-12 " align="center">
                            <button type="button" name="remove" id="2" class="btn btn-danger btn_removeeq">X</button>
                        </div>
                    </div>
                </template>

            </form>
        </div>

    </div>



    <div id="part1" class="p-0">



        @*  tab-1 *@

        <div class="col-md-12 p-0">
            <div class="card">

                <div class="card-body">
                    <form id="frm1">
                        <input type="hidden" class="num" value="0" name="id" />
                        <input type="hidden" class="num" value="0" name="companyId" />
                        <div class="row">
                            <div class="col-md-6 my-2">
                                <label class="form-label">1. Corporate Identity Number (CIN) of the Company</label>
                                <input type="text" placeholder="CIN" class="form-control nums" value="" name="cin" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" disabled>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 my-2">
                                <label class="form-label">2. (a) Name of the Company</label>
                                <input type="text" placeholder="Company Name" class="form-control nums" value="" name="companyName" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" disabled>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-lg-12 my-2">
                                <label class="form-label">2. (b) Address of the registered office or principal place of business in India of the company</label>
                                <input type="text" placeholder="Address" class="form-control nums" value="" name="companyAddress" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" disabled>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="col-lg-12 my-2">
                                <label class="form-label">2. (c) E-mail ID of the company</label>
                                <input type="text" placeholder="Email" class="form-control nums" value="" name="companyEmail" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" disabled>
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-lg-7 my-3">
                                <label class="form-label" style="margin-right:1.2rem;">3. Whether the company is </label>
                                <input class="form-check-input mx-1" type="radio" style="border-color:grey; box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);" name="companyType" value="Public">
                                <label>
                                    Public Company
                                </label>
                                <input class="form-check-input mx-1" style="border-color:grey;" type="radio" name="companyType" value="Private">
                                <label>
                                    Private Company
                                </label>
                            </div>
                            <div class="col-lg-5 my-3">
                                <label class="form-label" style="margin-right:1.2rem;">4. Whether the company is a government company </label>
                                <input class="form-check-input mx-1" type="radio" style="border-color:grey;" name="isGov" value="true">
                                <label>
                                    Yes
                                </label>
                                <input class="form-check-input mx-1" style="border-color:grey;" type="radio" name="isGov" value="false">
                                <label>
                                    No
                                </label>
                            </div>

                            <div class="  d-flex justify-content-between mx-2 pt-3 ">
                                <p class="card-title mb-0 " style="margin-top:1px; border-bottom:1px solid black;">Deposit related information</p>
                            </div>
                            <div class="  d-flex justify-content-between mx-2 pt-3 ">
                                <p class="card-title mb-0 " style="margin-top:1px; border-bottom:1px solid black;">5. Total deposits outstanding as on the commencement of this Act</p>
                            </div>
                            <div class="col-md-6 my-3">
                                <label class="form-label">5. (a) Amount (in Rs.)</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="amt" readonly
                                       style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-6 my-3">
                                <label class="form-label">5. (b) Number of depositors</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="numberOfDepositors" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-12 my-3">
                                <h6 class="typecharge" style=" border-bottom:1px solid black; display:inline-block;">
                                    6. Details of total deposits mentioned at 5 above under following heads
                                </h6>
                            </div>
                            <div class="col-md-4 my-2">
                                <label class="form-label">Deposits due but not paid</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="depositsDueButNotPaid" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="col-md-4 my-2">
                                <label class="form-label">Interest due thereon but not paid</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="interestDueThereOnButNotPaid" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="col-md-4 my-2">
                                <label class="form-label">Deposits due but not claimed</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="depositsDueButNotClaimed" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="col-md-6 my-2">
                                <label class="form-label">Interest due thereon but not claimed</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="interestDueThereOnButNotClaimed" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="col-md-6 my-2">
                                <label class="form-label">Deposits not yet due for repayment</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="depositsNotYetDueForRepayment" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>


                            <div class="col-md-6 my-2">
                                <label class="form-label">  7. Deposits due for repayment in next three months</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="depositsDueForRepaymentThreeMonths" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="col-md-6 my-2">
                                <label class="form-label">8. Arrangements made for repayment of deposits due for repayment</label>
                                <input type="text" placeholder="" class="form-control nums" value="" name="arrangementForRepaymentDepositsDue" style="box-shadow: 0 0 11px 1px rgba(0, 0, 0, .05);">
                                <div class="invalid-feedback"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <div class="col-m-12 mt-3">
        <button class="btn btn-md btn-primary" style="float: right;" onclick="save1(event)">
            Submit
        </button>
    </div>

</div>



<script>
           function calculateTotalDeposits() {
        const fields = [
            "depositsDueButNotPaid",
            "interestDueThereOnButNotPaid",
            "depositsDueButNotClaimed",
            "interestDueThereOnButNotClaimed",
            "depositsNotYetDueForRepayment"
        ];

        let total = 0;

        fields.forEach(function (name) {
            const val = parseFloat($(`[name='${name}']`).val()) || 0;
            total += val;
        });

        $("[name='amt']").val(total.toFixed(2));
    }

    
    $(document).on("input", "[name='depositsDueButNotPaid'], [name='interestDueThereOnButNotPaid'], [name='depositsDueButNotClaimed'], [name='interestDueThereOnButNotClaimed'], [name='depositsNotYetDueForRepayment']", function () {
        
        const cleanValue = $(this).val().replace(/[^\d.]/g, '');

       
        const parts = cleanValue.split('.');
        if (parts.length > 2) {
            $(this).val(parts[0] + '.' + parts[1]); 
        } else {
            $(this).val(cleanValue);
        }

        calculateTotalDeposits();
    });







        $(document).on("change", "#declarationDate", function () {
        const selectedDate = new Date($(this).val());
        const currentDate = new Date();

        let error = "";

        if (isIncorpDateLoaded && dateOfIncorporation && selectedDate < dateOfIncorporation) {
            error = "Date cannot be before Date of Incorporation.";
        }

        const $feedback = $(this).next(".invalid-feedback");
        if (error) {
            $(this).addClass("is-invalid");
            $feedback.text(error).show();
        } else {
            $(this).removeClass("is-invalid");
            $feedback.text("").hide();
        }
    });


</script>
@section Scripts {
    <script>
         let dateOfIncorporation = null;
        let isIncorpDateLoaded = false;


        const dropdownMap = {
            "Director": {
                api: "https://dev-api.complycrafter.com/api/Director/ByCompany/",
                dropdownId: "#drpDirector",
                labelKeys: ["firstName", "lastName"],
                valueKey: "din"
            },
            "Manager": {
                api: "https://dev-api.complycrafter.com/api/Director/ByCompany/",
                dropdownId: "#drpManager",
                labelKeys: ["name"],
                valueKey: "pan"
            },
            "CEO": {
                api: "/api/ceo?companyId=",
                dropdownId: "#drpCeo",
                labelKeys: ["name"],
                valueKey: "pan"
            },
            "CFO": {
                api: "/api/cfo?companyId=",
                dropdownId: "#drpCfo",
                labelKeys: ["name"],
                valueKey: "pan"
            },
            "Company Secretary": {
                api: "/api/secretary?companyId=",
                dropdownId: "#drpCompanySecretary",
                labelKeys: ["name"],
                valueKey: "membershipNumber"
            }
        };

        $(document).on("change", "#designation", function () {
            const designation = $(this).val();
            const companyId = $("[name='companyId']").val();

            
            $("#managerPan").show().val("").prop("disabled", false);
            $("#drpDirector, #drpManager, #drpCeo, #drpCfo, #drpCompanySecretary").hide().empty();

            if (dropdownMap[designation]) {
                const config = dropdownMap[designation];
                const apiUrl = config.api + companyId;

              
                $("#managerPan").hide();
                const $targetDropdown = $(config.dropdownId).show();

               
                $targetDropdown.append(`<option value="">Select ${designation}</option>`);

                $.getJSON(apiUrl, function (data) {
                    if (Array.isArray(data) && data.length > 0) {
                        data.forEach(function (item) {
                            const label = config.labelKeys.map(k => item[k] || "").filter(Boolean).join(" ");
                            const value = item[config.valueKey] || "";
                            if (value) {
                                $targetDropdown.append(
                                    $("<option></option>").val(value).text(`${label} (${value})`)
                                );
                            }
                        });
                    } else {
                        $targetDropdown.append('<option disabled>No records found</option>');
                    }
                }).fail(function () {
                    $targetDropdown.append('<option disabled>Error fetching data</option>');
                });
            }
        });






        let rowCount = 1;
        $('#attachmentadd').click(function () {
            rowCount++;
            const templateContent = $('#rowTemp').html();
            const newRow = $(templateContent.replace(/2/g, rowCount));
            $('#equity').append(newRow);
            $('#l').val(rowCount);
            updateSerialNumbers();
        });

        $('#equity').on('click', '.btn_removeeq', function () {
            $(this).closest('.row').remove();
            rowCount--;
            $('#l').val(rowCount);
            updateSerialNumbers();
        });

        function updateSerialNumbers() {
            $('#equity .row').each(function (index) {
                $(this).find('.form-row:first').text(index + 1 + '.');
            });
        }

        var frm1 = {
            id: 0,
            companyId: 0,

            cin: "",
            companyName: "", 
            companyAddress: "",
            companyEmail: "", 
            companyType: "", 
            isGov: "",
            amt: "",
            numberOfDepositors: "",
            depositsDueButNotPaid: "",
            interestDueThereOnButNotPaid: "", 
            depositsDueButNotClaimed: "",
            interestDueThereOnButNotClaimed: "",
            depositsNotYetDueForRepayment: "",
            depositsDueForRepaymentThreeMonths: "",
            arrangementForRepaymentDepositsDue: "" ,
            resolutionNo:"",
            resolutionDate: "",

        }

        var voFrm1 = {
            id: 'required', 
            companyId: 'required', 
            cin: 'required',
            companyName: 'required',
            companyAddress: 'required',
            companyEmail: {
                required: true,
                email: true 
            },
            companyType: 'required',
            isGov: 'required',
            amt: 'required',
            numberOfDepositors: 'required',
            depositsDueButNotPaid: 'required',
            interestDueThereOnButNotPaid: 'required', 
            depositsDueButNotClaimed: 'required',
            interestDueThereOnButNotClaimed: 'required',
            depositsNotYetDueForRepayment: 'required',
            depositsDueForRepaymentThreeMonths: 'required', 
            arrangementForRepaymentDepositsDue: 'required'
        };

        var vfFrm1 = null;

        $(document).ready(function () {

            $("#part2").hide();
            $("#part3").hide();
            $('a[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
                var active = $(e.target).attr('role');
                $("#part1").hide();
                $("#part2").hide();
                $("#part3").hide();
                $("#" + active).show();

            });

            load()
            vfFrm1 = $('#frm').validate({ rules: voFrm1, onsubmit: () => { console.log('submit') } })


        })

        function save1(event) {
            event.preventDefault(); // Prevents the default action

            // let isValid = true;
            // if (!vfFrm1.form()) isValid = false;

            // if (!isValid) return;

            var obj = getObj(frm1, '#frm');

            console.log(obj)
            $._post(`@R.ApiUrl/DPT4`, obj).then(x => {
                console.log(x)
                if (x.status) {
                    window.location = `@Url.Action("DPT4", "Form")`
                } else {
                    swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: x.message
                    })
                }
            })

        }

        function load() {
            if (@ViewBag.id > 0) {
                $._get(`@R.ApiUrl/@ViewBag.ctrl/${@ViewBag.id}`).then(x => {
                    frm = x
                    setObj(x, "#frm")
                })
            }
            var company = localStorage.getItem("comp_id");
            if (company === null || company === undefined || company === "0") {
                alert("Please select Company")
                window.location = `@Url.Action("DPT4", "Form")`
                return;
            }
            $._get(`@R.ApiUrl/Company/${company} `).then(x => {
                $("[name='companyId']").val(x.id);
                $("[name='cin']").val(x.cin);
                $("[name='companyName']").val(x.companyName);
                $("[name='companyAddress']").val(x.address);
                $("[name='companyEmail']").val(x.email);
                 dateOfIncorporation = new Date(x.incorporationDate);
            isIncorpDateLoaded = true;
            })
        }
    </script>
}