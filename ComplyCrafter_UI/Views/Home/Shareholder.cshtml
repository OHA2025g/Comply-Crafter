@{
    ViewData["Title"] = "Shareholder Master";
    ViewBag.ShowSearch = true;
    ViewBag.ShowClear = true;
}

@section HeaderBlock {
    <h4 name="company_name"></h4>
}
<div class="row m-auto">
    <div class="card">
        <div class="card-header d-flex justify-content-between mb-3">
            <h3 class="card-title mb-0 fs-4" style="margin-top:1px">@ViewBag.ctrl</h3>
            <button class="btn btn-sm btn-outline-primary" onclick="add()"><i class="fa fa-plus px-2 fs-6"></i>Add</button>
        </div>
        <div class="card-body">
            <table id="tbl" class="display nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Sr No</th>
                        <th>Shareholder's Name</th>
                        <th>Category</th>
                        <th>Sub Category</th>
                        <th>Under Sub Category</th>
                        @* <th>Status</th> *@
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            loadTbl()
        });
        function loadTbl() {
            if ($.fn.DataTable.isDataTable('#tbl')) {
                $('#tbl').DataTable().destroy();
            }
            let table = $('#tbl').DataTable({
                ajax: {
                    url: `@R.ApiUrl/@ViewBag.ctrl/List`,
                    data: function (d) {
                        d.companyId= localStorage.getItem("comp_id");
                        return d;
                    },
                    dataSrc: ""
                },
                columns: [
                    {
                        "targets": 0,
                        "render": function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    },
                    {
                        render: (a, b, c) => `${c.firstName} ${c.middleName} ${c.lastName}`
                    },
                    { data: 'category' },
                    { data: 'subCategory' },
                    { data: 'underSubCategory' },
                    // {
                    //     data: 'isActive',
                    //     render: (data, type, row) => `
                    //               <input type="checkbox" data-toggle="toggle" data-on="Active" data-size="sm" data-id="${row.id}" data-off="Inactive" ${data ? 'checked' : ''} onchange="changeActive(${row.id}, ${data})" data-onstyle="success" data-offstyle="danger">
                    //             `
                    // },
                    {
                        data: null,
                        orderable: false,
                        render: function (data, type, row) {
                            return `
                              <div class="d-flex justify-content-center">
                                        <a onclick="view(${row.id})" class="mx-2" style="color: blue; cursor: pointer;" title="View Shareholder">
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        <a onclick="edit(${row.id})" class="mx-2" style="color: green; cursor: pointer;" title="Edit Shareholder">
                                            <i class="fa fa-pencil-alt"></i>
                                        </a>
                                        <a onclick="del(${row.id})" class="mx-2" style="color: red; cursor: pointer;" title="Delete Shareholder">
                                            <i class="fa fa-trash-alt"></i>
                                        </a>
                                    </div>`;
                        }
                    },
                ],
                order: [],
                "drawCallback": function () {
                    $('.dataTables_length').parent().removeClass('d-flex').removeClass('justify-content-between').addClass('d-flex').addClass('justify-content-between')
                    $('input[data-toggle="toggle"]:not(.initialized)').bootstrapToggle().addClass('initialized');
                }
            });
        }
        function changeActive(id, currentStatus) {
            $.get(`@R.ApiUrl/@ViewBag.ctrl/${id}/Status/${!currentStatus}`).then(r => {
                toastr[r.status ? 'success' : 'error'](r.message);
                $('#tbl').DataTable().ajax.reload()
            })
        }
        function del(id) {
            if (!confirm('Are you sure you want to delete this @ViewBag.ctrl')) return;
            $.get(`@R.ApiUrl/@ViewBag.ctrl/${id}/delete`).then(r => {
                toastr[r.status ? 'success' : 'error'](r.message);
                $('#tbl').DataTable().ajax.reload()
            })
        }
        function add() {
            window.location = `@Url.Action("Shareholder", "Home")/Add`;
        }
        function edit(id) {
            window.location = `@Url.Action("Shareholder", "Home")/Edit/${id}`;
        }
    </script>
}