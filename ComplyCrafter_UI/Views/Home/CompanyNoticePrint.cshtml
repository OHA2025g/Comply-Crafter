@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Meeting Notice</title>
    <link href="~/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="~/assets/plugins/jquery/jquery-3.5.1.min.js"></script>
    <script src="~/assets/plugins/moment/moment.min.js"></script>
    <script>
        var url = '@R.ApiUrl/Auth/Validate';
        $.ajaxSetup({ headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` } });
        $.ajax({ url: `@R.ApiUrl/@ViewBag.ctrl/@ViewBag.id`, type: 'GET', async: false, success: function (r) { window.data = r; } });
        $.ajax({ url: `@R.ApiUrl/Company/${data.companyId}`, type: 'GET', async: false, success: function (r) { window.company = r; } });
        JSON.parse(window.data.resolution).map(item => {
            $.get(`@R.ApiUrl/Resolution/${item.resolutionId}`).then(r => {
                r.agendaText = replaceTxt(r.agendaText, item)
                var newItem = $('<li></li>').html(r.agendaText);

                $('#agenda').append(newItem);

                // r.meetingText = replaceTxt(r.meetingText, item)
                // r.resolutionText = replaceTxt(r.resolutionText, item)

                // const cardsContainer = $('#cardsContainer');
                // const cardsHtml = cardTemplate(r);
                // cardsContainer.append(cardsHtml);
            }).catch(error => {
                console.error("Error loading data: ", error);
            });
        })


        const cardTemplate = (data) => `
            <div class="card">
                <div class="card-header d-flex justify-content-between mb-3">
                    <h3 class="card-title mb-0 fs-4" style="margin-top:1px">${data.title}</h3>
                </div>
                <div class="card-body">
                    <p><strong>Agenda Text:</strong> ${data.agendaText}</p>
                    <p><strong>Meeting Text:</strong> ${data.meetingText}</p>
                    <p><strong>Resolution Text:</strong> ${data.resolutionText}</p>
                </div>
            </div>
        `;

        function replaceTxt(txt, obj) {
            var txt1 = '' + txt;
            [...txt.matchAll(/\{.*?\}/gm)].map(q => q[0]).forEach(v => {
                var key = v.replaceAll(' ', '_').replaceAll('{', '').replaceAll('}', '');
                txt1 = txt1.replace(v, `<b>${obj[key]}</b>`);
            })
            return txt1

        }
    </script>
    <style>
        .notice-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .text-center {
            text-align: center;
        }

        .agenda-list {
            list-style-type: disc;
            margin-left: 20px;

        }
    </style>
</head>
<body>
    <div class="notice-container">
        <h3 class="text-center">Notice of Meeting</h3>
        <div class="text-center">
            <strong><script>document.write(company.companyName)</script></strong><br>
            @* <script>document.write(company.address)</script> *@
        </div>
        <div class="mt-3">
            <p><strong>Date:</strong> <script>document.write(moment(data.issueDate).format('DD.MM.YYYY'))</script></p>
        </div>
        <h5 class="text-center"><strong>NOTICE</strong></h5>
        <p class="text-center">
            NOTICE is hereby given that the <script>document.write(data.type)</script> of the Company will be held at the company premises on
            <strong>
                <script>
                    document.write(moment(data.meetingDate)
                        .format('dddd, [the] Do MMMM, YYYY [at] hh:mm A'))</script>
            </strong> to consider the agenda items given below.
            All of our members are requested to be present at the meeting.
        </p>
        @* <p class="mt-4"><strong>By Order</strong></p>
        <p>MD. Ashraf Khan<br>Secretary</p>
        <h5 class="mt-4"><strong>Agenda</strong></h5> *@
        <ul class="agenda-list" id="agenda">
        </ul>
    </div>

    <script>
        // window.print();
    </script>
</body>
</html>
