@{
	Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="@R.AppName Dashboard">
	<meta name="keywords" content="admin,dashboard">
	<meta name="author" content="stacks">
	<title>@R.AppName @(ViewData["Title"] != null ? $"- {ViewData["Title"]}" : "")</title>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;300;400;500;600;700;800&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
	<link href="~/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="~/assets/plugins/perfectscroll/perfect-scrollbar.css" rel="stylesheet">
	<link href="~/assets/plugins/pace/pace.css" rel="stylesheet">
	<link href="~/assets/plugins/highlight/styles/github-gist.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/v/bs5/dt-2.1.8/b-3.2.0/b-colvis-3.2.0/b-html5-3.2.0/r-3.0.3/sc-2.4.3/datatables.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.1.1/css/bootstrap5-toggle.min.css" rel="stylesheet">
	<link href="~/assets/css/main.min.css" rel="stylesheet">
	<link href="~/assets/css/custom.css" rel="stylesheet">
	<link href="~/assets/plugins/select2/css/select2.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

	<link rel="icon" type="image/png" sizes="32x32" href="~/img/logos/logo_sq_2.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="~/img/logos/logo_sq_2.png" />
	<link rel="icon" href="~/img/favicon.png" />
	<link rel="shortcut icon" href="~/img/favicon.png" />
	<link rel="apple-touch-icon" href="~/img/favicon.png" />
	<link href="~/assets/plugins/toastr/toastr.min.css" rel="stylesheet" />
	<link href="~/css/site.css" rel="stylesheet" asp-append-version="true" />
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.css" rel="stylesheet">
	<script src="~/assets/plugins/jquery/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>



</head>

<body>

	<!-- Javascripts -->
	<script src="~/assets/plugins/bootstrap/js/popper.min.js"></script>
	<script src="~/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="~/assets/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
	<script src="~/assets/plugins/pace/pace.min.js"></script>
	<script src="~/assets/js/main.min.js"></script>
	<script src="~/assets/js/custom.js"></script>
	<script src="~/assets/plugins/toastr/toastr.min.js"></script>
	<script src="~/js/site.js" asp-append-version="true"></script>
	<script src="~/assets/plugins/highlight/highlight.pack.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
	<script src="https://cdn.datatables.net/v/bs5/dt-2.1.8/b-3.2.0/b-colvis-3.2.0/b-html5-3.2.0/r-3.0.3/sc-2.4.3/datatables.min.js"></script>
	<script src="~/assets/plugins/moment/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.21.0/jquery.validate.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.1.1/js/bootstrap5-toggle.jquery.min.js"></script>
	<script src="~/assets/plugins/select2/js/select2.full.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"></script>



	<script>

		$(document).ready(function ()
		{
			localStorage.setItem('authToken', '');
			if('@ViewBag.EmailAddress')
			{
				$.ajax({
					url: '@($"{R.ApiUrl}/Auth/AuthenticateUserByGmail?emailId={ViewBag.EmailAddress}")',
					type: 'POST',
					success: data => {
						//debugger
						if (data.status) {
							toastr.success(data.message);
							localStorage.setItem('CCUser', '@ViewBag.EmailAddress');
							localStorage.setItem('authToken', data.responseObject);
							$.cookie("ComplyCrafterBrowserId", '@ViewBag.BrowserId', {
								expires : new Date(new Date().getTime() + '@ViewBag.SessionValidity'),
								path    : '/',
								secure  : true
							});
							$.cookie("ComplyCrafterSessionId", data.responseObject, {
								expires : new Date(new Date().getTime() + '@ViewBag.SessionValidity'), //10 * 60 * 1000
								path    : '/',
								secure  : true
							});
							fnEndPrevSession();
							window.location = '@Url.Action("Index", "Home")'
						}
						else
						{
							if(data.message == 'User not found.')
								window.location = '@Url.Action("Login", "Home")' + '?message=' + encodeURIComponent(data.message)
							else
								window.location = '@Url.Action("VerifyOtp", "Home")' + '?emailId=' + '@ViewBag.EmailAddress' + '&message=' + encodeURIComponent(data.message)
						}
							// window.location = '@Url.Action("Login", "Home")' + '?message=' + encodeURIComponent(data.message);
					}
				});
			}
			else
				window.location = '@Url.Action("Login")';


		function fnEndPrevSession()
		{
			$(document).ready(function () {
				let auth = {
					EmailId: localStorage.getItem('CCUser')
				};

				$.ajax({
					url: '@R.ApiUrl/Auth/UpdateDuplicateSession',
					data: JSON.stringify(auth),
					contentType: 'application/json',
					type: 'POST',
					headers: {
						'Authorization': 'Bearer ' + $.cookie("ComplyCrafterSessionId")
					},
					success: data => {
						//debugger
						if (data.status) {
							toastr.error('Your previous session is active in another browser.');
						}
						SaveSession();
					}
				});
			});
		}
		function SaveSession()
		{
			$(document).ready(function () {
			let auth = {
				EmailId: localStorage.getItem('CCUser'),
				BrowserId: '@ViewBag.BrowserId',
				SessionId: $.cookie("ComplyCrafterSessionId")
			};

			$.ajax({
				url: '@R.ApiUrl/Auth/SaveLoginTracker',
				data: JSON.stringify(auth),
				contentType: 'application/json',
				type: 'POST',
				headers: {
					'Authorization': 'Bearer ' + $.cookie("ComplyCrafterSessionId")
				},
				success: data => {
					//debugger
					if (data.status) {
					}
					window.location = '@Url.Action("Index")'
				}
				});
			});
		}
		});
	</script>

</body>
</html>